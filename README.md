# 实验二 Etest 测试智能飞镖感应设备实验教程

本教程完全适配你的场景：**虚拟串口 COM1/COM5** + 智能飞镖感应设备需求文档 + 给定的 project 测试项目文件夹，从 “软件安装→环境配置→用例执行→问题报告” 全流程拆解，零基础也能一步步操作。

## 一、前期准备（必做）

### 1.1 软件安装（确认已安装，未安装则按以下步骤）

| 软件名称                | 用途                               | 安装要点                                                     |
| ----------------------- | ---------------------------------- | ------------------------------------------------------------ |
| Etest                   | 核心测试工具                       | 下载对应 Windows 版本（32/64 位），默认安装路径（如`D:\Etest`），安装后桌面生成 “Etest” 快捷方式 |
| 虚拟串口工具（如 VSPD） | 模拟 COM1/COM5 串口通信            | 安装后打开，点击 “Add pair” 添加串口对（COM1↔COM5），确认 “Port Status” 为 “Connected” **要重启?** |
| VS Code（可选）         | 编辑 Lua 脚本 / 查看 YAML 测试数据 | 安装后打开，安装 “Lua”“YAML” 插件（方便编辑项目文件夹里的脚本和数据文件） |

### 1.2 项目文件准备

1. 将你拿到的 “project 测试项目文件夹” 解压到**非中文路径**（如`D:\test_project`，避免 Etest 识别失败）；

2. 需求文档.pdf 放在项目文件夹同级目录，方便随时查阅；

3. 确认项目文件夹结构（和你提供的一致）：

   ```plaintext
   project/
   ├─ .gitignore        # 版本控制配置（无需修改）
   ├─ .etest-oss/       # 调试配置（无需修改）
   │  ├─ launch.json
   │  └─ settings.json
   ├─ testdata/         # 测试数据（YAML格式，可直接用）
   │  ├─ data.yml
   │  ├─ data_biao.yml
   │  └─ ...
   ├─ env/              # 串口环境配置（核心）
   │  └─ env.env
   └─ func/             # 测试脚本（Lua格式，核心）
      ├─ 1shoot.lua
      ├─ 2target.lua
      └─ ...
   ```

   

## 二、Etest 基础认知（零基础必看）

打开 Etest，先认核心界面（避免操作迷路）：

| 界面模块   | 位置                            | 用途                                  |
| ---------- | ------------------------------- | ------------------------------------- |
| 项目管理区 | 左侧                            | 导入 / 新建项目、查看项目文件结构     |
| 环境配置区 | 顶部菜单栏「配置」→「环境配置」 | 设置串口、设备参数（匹配需求）        |
| 脚本编辑区 | 中间主界面                      | 打开 / 编辑 func 里的 Lua 测试脚本    |
| 执行监控区 | 底部                            | 查看脚本执行日志、串口数据收发记录    |
| 用例管理区 | 右侧                            | 录入 / 编辑测试用例、查看用例执行结果 |

## 三、项目导入与环境配置（关键步骤）

### 3.1 导入测试项目

1. 打开 Etest，点击顶部菜单栏「项目」→「导入项目」；
2. 在弹出的窗口中，选择你解压后的`project`文件夹根目录，点击「确定」；
3. 等待导入完成（约 10 秒），左侧项目管理区会显示`project`项目及所有子文件（testdata、env、func）。

### 3.2 串口环境配置（匹配需求 + COM1/COM5）

需求文档中串口核心参数：波特率 9600、校验位无、数据位 8、停止位 1，需严格配置：

1. 点击顶部菜单栏「配置」→「环境配置」→「设备配置」；

2. 选择「串口设备」，点击「添加设备」，填写：

   | 配置项   | 取值（COM1：飞镖数据发送端） | 取值（COM5：靶体数据接收端） |
   | -------- | ---------------------------- | ---------------------------- |
   | 设备名称 | 仿真飞镖设备（COM1）         | 靶体控制模块（COM5）         |
   | 串口编号 | COM1                         | COM5                         |
   | 波特率   | 9600                         | 9600                         |
   | 校验位   | 无                           | 无                           |
   | 数据位   | 8                            | 8                            |
   | 停止位   | 1                            | 1                            |

3. 点击「测试连接」，若提示 “串口连接成功”，点击「保存」；若失败，检查虚拟串口工具是否已添加 COM1/COM5，且无其他软件占用串口。

4. 导入环境配置文件：

   

   双击左侧项目管理区「env」→「env.env」，点击「导入配置」，将文件中的设备和连接关系加载到 Etest（无需手动改参数，文件已适配需求）。

## 四、核心测试用例执行（分模块，零基础手把手）

项目文件夹中的`func`目录已写好 4 个核心 Lua 脚本，对应需求文档的关键功能，按以下步骤执行：

### 模块 1：飞镖信息输入测试（执行 1shoot.lua）

**测试目标**：验证 COM1 发送飞镖类型 / 数量数据后，软件能否正确接收并更新参数

1. 左侧项目管理区双击「func」→「1shoot.lua」，脚本会在中间编辑区打开，核心代码解读（零基础不用改，直接用）：

   lua

   

   

   

   

   

   ```lua
   -- 串口初始化（绑定COM1）
   local serial_shoot = Serial.Open("COM1", 9600, 8, "NONE", 1)
   -- 测试数据：飞镖类型=1（轻镖），数量=24（超出范围，验证截断功能）
   local shoot_data = "AA 55 BB 01 18 C4 55 AA"  -- 数据帧按需求格式构造
   -- 发送数据到COM1
   Serial.Send(serial_shoot, shoot_data)
   -- 打印日志（查看执行结果）
   Log.Info("飞镖数据已发送："..shoot_data)
   ```

   

2. 点击编辑区右上角「运行脚本」，底部执行监控区会显示日志；

3. 验证结果：

   

   打开被测的飞镖控制软件，查看界面是否显示：飞镖类型 = 轻镖，数量 = 20（24 超出范围自动截断为 20），定时器时间 = 60 秒（轻镖 11-20 枚对应 60 秒）；

   

   若未更新，检查：①串口连接是否成功；②脚本中串口编号是否为 COM1；③数据帧格式是否匹配需求。

### 模块 2：靶体信息测试（执行 2target.lua）

**测试目标**：验证 COM5 接收靶区数据后，软件能否更新投中数量、剩余飞镖数

1. 双击「func」→「2target.lua」，核心代码：

   lua

   

   

   

   

   

   ```lua
   -- 绑定COM5串口
   local serial_target = Serial.Open("COM5", 9600, 8, "NONE", 1)
   -- 测试数据：投中区域=6（外牛眼区）
   local target_data = "AA 55 CC 06 11 E4 55 AA"
   -- 循环发送10次（模拟10枚飞镖投中）
   for i=1,10 do
       Serial.Send(serial_target, target_data)
       Log.Info("第"..i.."次靶区数据发送："..target_data)
       Time.Sleep(1000)  -- 间隔1秒发送
   end
   ```

   

2. 点击「运行脚本」，底部日志会显示每次发送的记录；

3. 验证结果：

   

   被测软件界面应显示：剩余飞镖数从 10→0，外牛眼区投中数量 = 10，总得分 = 10×3=30 分（轻镖外牛眼区得 3 分，需求文档定义）。

### 模块 3：飞镖接口容错测试（执行 3interface_shoot.lua）

**测试目标**：验证软件对错误数据帧（校验和错误、包头错误）的丢包处理能力

1. 双击「func」→「3interface_shoot.lua」，脚本已构造 3 类错误数据帧：

   - 错误 1：校验和错误（正确校验和 C6，改为 C7）；
   - 错误 2：包头错误（正确 AA55，改为 AA56）；
   - 错误 3：干扰字节（添加 55AA，验证剔除功能）。

2. 点击「运行脚本」，脚本会弹出交互框，询问 “是否观察到软件响应？”；

3. 验证结果：

   

   所有错误数据帧发送后，被测软件界面无任何变化（丢包成功），符合需求 3.1 的容错规则。

### 模块 4：靶体接口容错测试（执行 4interface_target.lua）

操作步骤和模块 3 完全一致：

1. 打开脚本，确认错误数据帧（校验和、包头错误）；
2. 运行脚本，观察被测软件是否无响应（丢包成功）；
3. 若软件接收了错误数据，记录问题（后续写入问题报告）。

## 五、测试结果记录与问题报告编写（核心交付物）

### 5.1 测试代码截图（按以下要求截）

需包含 “脚本内容 + 执行日志 + 串口配置”，共 3 张截图：

1. 截图 1：Etest 脚本编辑区（如 1shoot.lua）+ 底部执行日志（显示 “数据已发送”）；

2. 截图 2：Etest 环境配置界面（COM1/COM5 参数）；

3. 截图 3：被测软件界面（显示飞镖参数 / 投中数量）。

   

   → 截图保存为 PNG 格式，命名为 “测试用例 X_截图.png”（X 为 1-4）。

### 5.2 测试用例描述（填表格，直接套用）

| 需求编号 | 测试用例描述                                                 | 输入数据（数据帧）                                 | 预期输出                                                    | 实际输出                                                    | 问题描述                                               |
| -------- | ------------------------------------------------------------ | -------------------------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------ |
| 2.2      | 模拟飞镖设备通过 COM1 发送轻镖、数量 24 枚的正确数据帧，测试软件数量截断功能 | COM1 发送：AA 55 BB 01 18 C4 55 AA                 | 软件界面显示：飞镖类型 = 轻镖，数量 = 20 枚，定时器 = 60 秒 | 软件界面显示：飞镖类型 = 轻镖，数量 = 20 枚，定时器 = 60 秒 | 无                                                     |
| 3.1      | 模拟飞镖设备通过 COM1 发送校验和错误的飞镖数据帧，测试软件容错能力 | COM1 发送：AA 55 BB 01 0A C7 55 AA（校验和错误）   | 软件界面无变化（丢包）                                      | 软件界面无变化                                              | 无                                                     |
| 3.1      | 模拟飞镖设备通过 COM1 发送带干扰字节 55AA 的飞镖数据帧，测试软件剔除功能 | COM1 发送：55 AA AA 55 BB 01 0A C6 55 AA（含干扰） | 软件剔除干扰字节，更新飞镖参数为轻镖 10 枚                  | 软件界面无变化                                              | 软件未剔除干扰字节，无法识别正确数据帧，不符合需求 3.1 |
| 2.5      | 模拟靶体通过 COM5 发送 10 次外牛眼区数据帧，测试投镖结束逻辑 | COM5 循环发送：AA 55 CC 06 11 E4 55 AA（10 次）    | 软件提示 “投镖完成！”，剩余飞镖 = 0，总得分 30 分           | 软件提示 “投镖完成！”，剩余飞镖 = 0，总得分 30 分           | 无                                                     |

### 5.3 问题报告格式（完整示例）

#### 问题报告

1. 测试场景：飞镖接口干扰字节剔除功能测试（需求 3.1）；
2. 测试代码截图：[附上截图 3]；
3. 测试用例描述：[如上表格第 3 行]；
4. 问题定位：软件未识别带干扰字节的正确数据帧，推测是干扰字节剔除逻辑未实现；
5. 复现步骤：①配置 COM1/COM5 串口；②运行 3interface_shoot.lua 发送带干扰字节的数据帧；③观察软件界面无更新。

## 六、零基础常见问题排查（避坑指南）

| 问题现象                     | 原因                                   | 解决方法                                                     |
| ---------------------------- | -------------------------------------- | ------------------------------------------------------------ |
| Etest 提示 “串口被占用”      | 其他软件（如串口助手）占用了 COM1/COM5 | 关闭所有串口工具，重启 Etest，重新测试连接                   |
| 脚本运行无日志               | 脚本路径含中文，Etest 识别失败         | 将 project 文件夹移到纯英文路径（如 D:\test_project）        |
| 被测软件接收不到数据         | 数据帧格式错误（如校验和计算错）       | 核对需求文档的帧格式，重新计算校验和（校验和 = 包头后 + 数据标志 + 类型 + 数量的十六进制和） |
| Lua 脚本报错 “Serial 未定义” | Etest 未加载串口插件                   | 点击「工具」→「插件管理」，安装 “串口通信插件”，重启 Etest   |

## 七、收尾：测试项目保存与导出

1. 点击 Etest 顶部「项目」→「保存项目」，将所有配置 / 执行结果保存到 project 文件夹；
2. 点击「项目」→「导出测试报告」，选择 “PDF 格式”，自动生成包含所有用例、截图、问题的完整报告。

如果操作中某一步卡住（比如串口连接失败、脚本运行报错），可以告诉我具体的错误提示，我会帮你针对性解决！
