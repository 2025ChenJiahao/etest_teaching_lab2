## 一、你这个实验到底要做什么？（核心任务就 1 件）

用 Etest 工具，通过**虚拟串口 COM2（对应飞镖软件的 COM1）、COM6（对应飞镖软件的 COM5）**，给 “智能飞镖感应软件” 发 2 类数据，看它有没有按需求干活，最后把 “干没干对” 的结果写成报告提交。

把这 2 测试的 “代码截图 + 测试结果表格” 放进报告，和 Etest 项目文件一起压缩提交。

## 二、project 里的 env/func 等文件夹，到底是啥？（每个都讲 “是什么 + 你要做啥”）

你不用管复杂逻辑，只记 “它装啥的 + 你对它的操作”，按文件夹逐个说：

| 文件夹 / 文件 | 到底是啥？（大白话）                                         | 你要对它做什么？（必做操作）                                 |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **env**       | 装 “串口配置” 的文件夹，核心是`env.env`文件 —— 这个文件规定了 Etest 用哪个串口发数据（比如 channels.shoot 绑定 COM2，对应飞镖软件的 COM1） | 1. 打开`env.env`，确认里面`channels.shoot`是 COM2、`channels.target`是 COM6；2. 啥都不用改，确认完保存就行（改错过一次，现在对了就别动） |
| **func**      | 装 “测试脚本” 的文件夹 —— 里面的 1shoot.lua、2target.lua 就是给 Etest 的 “指令单”，告诉 Etest 发什么数据 | 修改代码后保存后运行要在被测软件上点开始操作； 运行后看飞镖软件的反应，记下来 |
| **prot**      | 装 “数据格式规则” 的文件夹 —— 里面的文件规定了 Etest 发的数据长什么样（比如必须带包头 0xAA55、校验和，不然飞镖软件不认） | 你啥都不用动！这是项目自带的 “规则”，`write_msg`函数会自动按这规则发数据，改了反而错 |
| **run**       | 装 “运行日志” 的文件夹 —— 每次运行脚本，Etest 会把 “跑没跑成” 的记录存在这里（比如显示 “执行完成” 就是跑成了，“执行错误” 就是代码错了） | 不用管！如果脚本报错，打开这里的日志文件，能看到错在哪（比如之前 “Log 未定义” 的错就记在这里） |
| **testdata**  | 装 “预设测试数据” 的文件夹 —— 里面的 YAML 文件是预设的飞镖类型、数量（比如 data_biao.yml 里可能有轻镖 10 枚、重镖 15 枚的数据） | 你啥都不用动！你的脚本是直接写死参数（24 枚轻镖、zone=2），没用到这里的数据，不用改 |

## 三、根据需求写测试用例（包括功能需求、接口需求）

### （一）、功能需求测试用例

#### 2.1 系统启动

| 测试点编号 | 测试点名称       | 测试目的                                   | 测试步骤                                                     | 预期结果                                                     |
| ---------- | ---------------- | ------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.1-01   | 系统启动默认配置 | 验证系统启动后飞镖类型、数量是否符合默认值 | 1. 关闭待测件软件，重新启动；2. 查看待测件界面显示的飞镖类型、飞镖数量。 | 界面显示：飞镖类型 = 轻镖，飞镖数量 = 10 枚，感应设备状态 = 准备投镖。 |

#### 2.2 飞镖信息输入

| 测试点编号 | 测试点名称                         | 测试目的                                                     | 测试步骤                                                     | 预期结果                                                     |
| ---------- | ---------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.2-01   | 准备投镖状态接收有效参数（轻镖）   | 验证准备投镖状态下，接收轻镖 1-10 枚、11-20 枚参数的正确性（含定时器计算） | 1. 待测件复位至 “准备投镖” 状态；2. 运行 Etest 脚本发送：- 轻镖 type=1，num=8（1-10 枚）；- 轻镖 type=1，num=15（11-20 枚）；3. 查看飞镖类型、数量、定时器时间。 | - 发送 num=8：显示轻镖、8 枚，定时器 30 秒；- 发送 num=15：显示轻镖、15 枚，定时器 60 秒。 |
| F-2.2-02   | 准备投镖状态接收超范围参数（截断） | 验证飞镖数量超 [1,20] 时，是否截断为边界值                   | 1. 待测件复位至 “准备投镖” 状态；2. 运行 Etest 脚本发送：- 轻镖 type=1，num=24（超 20）；- 重镖 type=2，num=25（超 20）；3. 查看飞镖数量、定时器时间。 | - 发送 num=24：显示轻镖、20 枚，定时器 60 秒；- 发送 num=25：显示重镖、20 枚，定时器 90 秒。 |
| F-2.2-03   | 非准备投镖状态拒收飞镖信息         | 验证非准备投镖状态下，不接收飞镖参数                         | 1. 待测件复位后点击 “开始”，进入 “开始投镖” 状态；2. 运行 Etest 脚本发送轻镖 type=1，num=10；3. 查看飞镖类型、数量是否变化。 | 飞镖类型、数量、定时器时间无任何变化。                       |
| F-2.2-04   | 准备投镖状态接收未知物参数         | 验证未知物参数的定时器计算规则                               | 1. 待测件复位至 “准备投镖” 状态；2. 运行 Etest 脚本发送：type=3（未知物），num=10；3. 查看定时器时间。 | 显示未知物、10 枚，定时器 0 秒。                             |

#### 2.3 开始投镖

| 测试点编号 | 测试点名称                 | 测试目的                                                     | 测试步骤                                                     | 预期结果                                                     |
| ---------- | -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.3-01   | 准备投镖状态启动投镖       | 验证点击 “开始” 后，状态、剩余飞镖、总分、投中数量、定时器的正确性 | 1. 待测件复位至 “准备投镖”，发送轻镖 type=1，num=20；2. 点击 “开始” 按钮；3. 查看状态、剩余飞镖、总分、投中数量、定时器。 | - 状态：开始投镖；- 剩余飞镖 = 20；- 总分 = 0，所有区域投中数量 = 0；- 定时器启动倒计时（60 秒）。 |
| F-2.3-02   | 非准备投镖状态禁用开始投镖 | 验证投镖中 / 投镖结束状态下，“开始” 按钮无效                 | 1. 待测件进入 “开始投镖” 状态（或 “投镖结束” 状态）；2. 点击 “开始” 按钮；3. 查看状态是否变化。 | 状态无变化，“开始” 按钮点击后无响应。                        |

#### 2.4 接收靶区信息并计算分数



| 测试点编号 | 测试点名称               | 测试目的                                               | 测试步骤                                                     | 预期结果                                                     |
| ---------- | ------------------------ | ------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.4-01   | 轻镖投中各区域得分计算   | 验证轻镖投中不同区域的投中数量、剩余飞镖、总分计算规则 | 1. 待测件复位→发送轻镖 type=1，num=5→点击 “开始”；2. 运行 Etest 脚本依次发送：- zone=1（内牛眼）、zone=2（外牛眼）、zone=3（三倍区）、zone=4（双倍区）、zone=5（单倍区）；3. 查看每轮的投中数量、剩余飞镖、总分。 | - 内牛眼：投中 + 1，剩余 - 1，总分 + 5；- 外牛眼：投中 + 1，剩余 - 1，总分 + 3；- 三倍区：投中 + 1，剩余 - 1，总分 + 1；- 双倍区：投中 + 1，剩余 - 1，总分不变；- 单倍区：投中 + 1，剩余 - 1，总分 - 2（最低至 0）。 |
| F-2.4-02   | 重镖投中各区域得分计算   | 验证重镖投中不同区域的得分规则                         | 1. 待测件复位→发送重镖 type=2，num=5→点击 “开始”；2. 运行 Etest 脚本发送 zone=1（内牛眼）、zone=5（单倍区）；3. 查看总分变化。 | - 内牛眼：总分 + 4；- 单倍区：总分不变。                     |
| F-2.4-03   | 非投镖中状态拒收靶区信息 | 验证准备投镖 / 投镖结束状态下，不接收靶区数据          | 1. 待测件处于 “准备投镖”（或 “投镖结束”）状态；2. 运行 Etest 脚本发送 zone=2（外牛眼）；3. 查看剩余飞镖、投中数量、总分。 | 剩余飞镖、投中数量、总分无变化。                             |

#### 2.5 投镖结束

| 测试点编号 | 测试点名称                | 测试目的                                                | 测试步骤                                                     | 预期结果                                                     |
| ---------- | ------------------------- | ------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.5-01   | 剩余飞镖为 0 触发投镖结束 | 验证剩余飞镖 = 0 时的结束逻辑（提示、状态、速度、成绩） | 1. 待测件复位→发送轻镖 type=1，num=3→点击 “开始”；2. 发送 3 次 zone=2（外牛眼），使剩余飞镖 = 0；3. 查看提示、状态、投镖速度、成绩。 | - 提示：投镖完成！；- 状态：投镖结束；- 速度：按剩余时间判定（如剩余时间＜20 秒→慢速）；- 成绩：平均得分 = 9/3=3→良（轻镖）。 |
| F-2.5-02   | 定时器超时触发投镖结束    | 验证定时器到时间的结束逻辑（未完成投镖提示）            | 1. 待测件复位→发送轻镖 type=1，num=10→点击 “开始”（定时器 30 秒）；2. 不发送任何靶区数据，等待定时器超时；3. 查看提示、状态。 | - 提示：投镖完成！未完成投镖；- 状态：投镖结束；- 不再接收靶区信息。 |

#### 2.6 复位

| 测试点编号 | 测试点名称                | 测试目的                           | 测试步骤                                                     | 预期结果                                                     |
| ---------- | ------------------------- | ---------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| F-2.6-01   | 投镖结束状态复位          | 验证复位后状态、参数的正确性       | 1. 待测件进入 “投镖结束” 状态；2. 点击 “复位” 按钮；3. 查看状态、飞镖类型 / 数量、剩余飞镖、总分、投中数量。 | - 状态：准备投镖；- 飞镖类型 / 数量：上次设置值（如轻镖 20 枚）；- 剩余飞镖、总分、投中数量：清零；- 定时器：对应上次参数（60 秒）。 |
| F-2.6-02   | 准备 / 投镖中状态复位无效 | 验证非投镖结束状态下，复位按钮无效 | 1. 待测件处于 “准备投镖”（或 “开始投镖”）状态；2. 点击 “复位” 按钮；3. 查看状态、参数是否变化。 | 状态、飞镖类型 / 数量、剩余飞镖等无任何变化。                |

### （二）、接口需求测试用例

#### 3.1 数据传送机接口（COM 口，9600 波特率 / 8 数据位 / 无校验 / 1 停止位）

| 测试点编号 | 测试点名称       | 测试目的                        | 测试步骤                                                     | 预期结果（容错要求：错误帧丢包，界面无变化） |
| ---------- | ---------------- | ------------------------------- | ------------------------------------------------------------ | -------------------------------------------- |
| I-3.1-01   | 校验和错误容错   | 验证校验和错误时丢包            | 1. 待测件复位至准备投镖状态；2. 运行 Etest 脚本发送：校验和 = 0（错误值）；3. 查看飞镖参数是否变化。 | 飞镖类型、数量、定时器无变化（丢包）。       |
| I-3.1-02   | 包头错误容错     | 验证包头 = 0x5511（错误）时丢包 | 1. 待测件复位至准备投镖状态；2. 运行 Etest 脚本发送：包头 = 0x5511；3. 查看飞镖参数是否变化。 | 飞镖参数无变化（丢包）。                     |
| I-3.1-03   | 数据标志错误容错 | 验证数据标志≠0xBB 时丢包        | 1. 待测件复位至准备投镖状态；2. 运行 Etest 脚本发送：数据标志 = 0xAA；3. 查看飞镖参数是否变化。 | 飞镖参数无变化（丢包）。                     |
| I-3.1-04   | 包尾错误容错     | 验证包尾 = 0x5511（错误）时丢包 | 1. 待测件复位至准备投镖状态；2. 运行 Etest 脚本发送：包尾 = 0x5511；3. 查看飞镖参数是否变化。 | 飞镖参数无变化（丢包）。                     |

#### 3.2 靶体接口（COM 口，9600 波特率 / 8 数据位 / 无校验 / 1 停止位）

| 测试点编号 | 测试点名称          | 测试目的                         | 测试步骤                                                     | 预期结果（容错要求：错误帧丢包，界面无变化） |
| ---------- | ------------------- | -------------------------------- | ------------------------------------------------------------ | -------------------------------------------- |
| I-3.2-01   | 校验和错误容错      | 验证校验和错误时丢包             | 1. 待测件进入 “开始投镖” 状态（轻镖 20 枚）；2. 运行 Etest 脚本发送：校验和 = 0（错误值）；3. 查看剩余飞镖、投中数量。 | 剩余飞镖、投中数量无变化（丢包）。           |
| I-3.2-02   | 包头错误容错        | 验证包头 = 0x5511（错误）时丢包  | 1. 待测件进入 “开始投镖” 状态；2. 运行 Etest 脚本发送：包头 = 0x5511；3. 查看剩余飞镖、投中数量。 | 剩余飞镖、投中数量无变化（丢包）。           |
| I-3.2-03   | 数据标志 1 错误容错 | 验证数据标志 1≠0xCC 时丢包       | 1. 待测件进入 “开始投镖” 状态；2. 运行 Etest 脚本发送：数据标志 1=0x55；3. 查看剩余飞镖、投中数量。 | 剩余飞镖、投中数量无变化（丢包）。           |
| I-3.2-04   | 投中区域错误容错    | 验证投中区域 = 0x9（错误）时丢包 | 1. 待测件进入 “开始投镖” 状态；2. 运行 Etest 脚本发送：投中区域 = 0x9；3. 查看剩余飞镖、投中数量。 | 剩余飞镖、投中数量无变化（丢包）。           |
| I-3.2-05   | 数据标志 2 错误容错 | 验证数据标志 2≠0x11 时丢包       | 1. 待测件进入 “开始投镖” 状态；2. 运行 Etest 脚本发送：数据标志 2=0x55；3. 查看剩余飞镖、投中数量。 | 剩余飞镖、投中数量无变化（丢包）。           |
| I-3.2-06   | 包尾错误容错        | 验证包尾 = 0x5511（错误）时丢包  | 1. 待测件进入 “开始投镖” 状态；2. 运行 Etest 脚本发送：包尾 = 0x5511；3. 查看剩余飞镖、投中数量。 |                                              |


## 四、我们要写如图所示的测试用例说明

<img width="416" height="143" alt="image" src="https://github.com/user-attachments/assets/ff64139a-957f-4930-b61a-e0b32d3d2304" />

### 测试用例说明如下：
2.1:

<img width="1851" height="939" alt="image" src="https://github.com/user-attachments/assets/01b1e17f-33fe-4cd6-8116-578d3fd0e2e4" />


代码修改：1shoot.lua（仅修改）

```lua
-- 测试用例F-2.1-01：系统启动默认配置验证
function SysStartCheck()
  -- 脚本仅占位，核心为手动重启待测件后验证默认值
  etimer.delay(1000)  -- 等待1秒，给操作待测件的时间
  
  -- 弹出对话框，确认待测件启动后的默认配置
  local res = ask("yesno", {
      title = "测试提示",
      msg = "重启待测件后，界面是否显示：飞镖类型=轻镖、飞镖数量=10枚、状态=准备投镖？",
      default = true  -- 预期结果为true
  })
  
  -- 校验结果（匹配预期则PASS，否则FAIL）
  check(res, "系统启动默认配置符合需求2.1，验证通过", "系统启动默认配置错误，验证失败")
end

-- Etest脚本入口函数（必须保留）
function entry()
  SysStartCheck()
  exit()
end
```

```
[0] [run/1shoot.run] [2025-12-12 18:20:55] 开始执行 
[0] [仿真设备(脚本)] [START]
[0] [仿真设备(脚本)] [PASS] 系统启动默认配置符合需求2.1，验证通过
[0] [仿真设备(脚本)] [STOP]
[0] [run/1shoot.run] [2025-12-12 18:22:05] 执行通过
```
| 需求编号 | 测试用例描述                                                 | 输入数据                 | 预期输出                                                     | 实际输出                                                     | 问题描述 |
| -------- | ------------------------------------------------------------ | ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 2.1      | 关闭待测件软件并重新启动，查看界面显示的飞镖类型、飞镖数量及感应设备状态，验证系统启动默认配置 | 无（仅执行系统重启操作） | 界面显示：飞镖类型 = 轻镖，飞镖数量 = 10 枚，感应设备状态 = 准备投镖 | 界面显示：飞镖类型 = 轻镖，飞镖数量 = 10 枚，感应设备状态 = 准备投镖 | 无       |

2.2：
<img width="1883" height="930" alt="image" src="https://github.com/user-attachments/assets/adf92fcc-7445-4e2e-a425-a6341a41a329" />

代码修改：1shoot.lua（仅修改）

```lua
-- 飞镖信息输入全场景测试
function ShootInputTest()
  -- 轻镖8枚参数验证
  write_msg(channels.shoot,protocols.shoot,{type=1,number=8})
  etimer.delay(1000)
  local res1 = ask("yesno", {
      title = "提示",
      msg = "发送轻镖8枚后，界面显示轻镖、8枚吗？",
      default = true
  })
  check(res1, "轻镖8枚参数接收正确", "轻镖8枚参数接收错误")

  -- 轻镖15枚参数验证
  write_msg(channels.shoot,protocols.shoot,{type=1,number=15})
  etimer.delay(1000)
  local res2 = ask("yesno", {
      title = "提示",
      msg = "发送轻镖15枚后，界面显示轻镖、15枚吗？",
      default = true
  })
  check(res2, "轻镖15枚参数接收正确", "轻镖15枚参数接收错误")

  -- 轻镖24枚超范围验证
  write_msg(channels.shoot,protocols.shoot,{type=1,number=24})
  etimer.delay(1000)
  local res3 = ask("yesno", {
      title = "提示",
      msg = "发送轻镖24枚后，界面显示轻镖、20枚吗？",
      default = true
  })
  check(res3, "轻镖24枚超范围截断正确", "轻镖24枚超范围未截断")

  -- 重镖25枚超范围验证
  write_msg(channels.shoot,protocols.shoot,{type=2,number=25})
  etimer.delay(1000)
  local res4 = ask("yesno", {
      title = "提示",
      msg = "发送重镖25枚后，界面显示重镖、20枚吗？",
      default = true
  })
  check(res4, "重镖25枚超范围截断正确", "重镖25枚超范围未截断")

  -- 切换至开始投镖状态
  local res5 = ask("yesno", {
      title = "提示",
      msg = "已把待测件切到开始投镖状态了吗？",
      default = true
  })
  write_msg(channels.shoot,protocols.shoot,{type=1,number=10})
  etimer.delay(1000)
  local res6 = ask("yesno", {
      title = "提示",
      msg = "发送轻镖10枚后，类型和数量没变化吧？",
      default = true
  })
  check(res6, "非准备状态拒收飞镖信息", "非准备状态接收了飞镖信息")

  -- 切回准备投镖状态
  local res7 = ask("yesno", {
      title = "提示",
      msg = "已把待测件复位到准备投镖状态了吗？",
      default = true
  })
  write_msg(channels.shoot,protocols.shoot,{type=3,number=10})
  etimer.delay(1000)
  local res8 = ask("yesno", {
      title = "提示",
      msg = "发送未知物10枚后，界面显示未知物、10枚吗？",
      default = true
  })
  check(res8, "未知物参数接收正确", "未知物参数接收错误")
end

function entry()
  ShootInputTest()
  exit()
end
```

```plaintext
[0] [run/1shoot.run] [2025-12-12 18:39:25] 开始执行 
[0] [仿真设备(脚本)] [START]
[0] [仿真设备(脚本)] [PASS] F-2.2-01：轻镖8枚参数接收正确，定时器计算符合要求
[0] [仿真设备(脚本)] [PASS] F-2.2-01：轻镖15枚参数接收正确，定时器计算符合要求
[0] [仿真设备(脚本)] [FAIL] F-2.2-02：轻镖24枚超范围未截断或定时器计算异常
[0] [仿真设备(脚本)] [FAIL] F-2.2-02：重镖25枚超范围未截断或定时器计算异常
[0] [仿真设备(脚本)] [PASS] F-2.2-03：非准备投镖状态拒收飞镖信息，验证通过
[0] [仿真设备(脚本)] [PASS] F-2.2-04：未知物参数接收正确，定时器计算符合要求
[0] [仿真设备(脚本)] [STOP]
[0] [run/1shoot.run] [2025-12-12 18:42:25] 执行失败
```

| 需求编号 | 测试用例描述                                                 | 输入数据                                                     | 预期输出                                                     | 实际输出                                                     | 问题描述                                                     |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 2.2      | 1. 准备投镖状态发轻镖 8/15 枚；2. 准备投镖状态发轻镖 24 枚 / 重镖 25 枚；3. 开始投镖状态发轻镖 10 枚；4. 准备投镖状态发未知物 10 枚 | 1. 轻镖 type=1，num=8/15；2. 轻镖 type=1，num=24、重镖 type=2，num=25；3. 轻镖 type=1，num=10（非准备状态）；4. 未知物 type=3，num=10（准备状态） | 1. 8 枚：轻镖、8 枚；15 枚：轻镖、15 枚；2. 24 枚：轻镖、20 枚；25 枚：重镖、20 枚；3. 类型 / 数量无变化；4. 未知物、10 枚 | 1. 8 枚：轻镖、8 枚；15 枚：轻镖、15 枚；2. 24 枚：轻镖、24 枚；25 枚：重镖、25 枚；3. 类型 / 数量无变化；4. 未知物、10 枚 | 飞镖数量超 [1,20] 范围时，软件未自动截断为 20 枚，不符合需求要求 |


